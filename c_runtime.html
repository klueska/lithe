

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Lithe C Runtime &mdash; Lithe 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Lithe 1.0 documentation" href="index.html" />
    <link rel="up" title="API Reference" href="api_reference.html" />
    <link rel="next" title="Lithe C++ Runtime" href="cpp_runtime.html" />
    <link rel="prev" title="Lithe C++ Schedulers" href="cpp_sched.html" /> 
  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 0px 10px">
<div style="float:left;">
<a href="index.html">
  <img src="_static/logo.png" border="0" alt="Lithe"/>
</a>
</div>
<div style="position:relative; top:115px; float:right; font-size:20px;">
<i>Enabling Efficient Composition of Parallel Libraries</i>
</div>
<div style="clear:both"></div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cpp_runtime.html" title="Lithe C++ Runtime"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cpp_sched.html" title="Lithe C++ Schedulers"
             accesskey="P">previous</a> |</li>
  <li><a href="index.html">Home</a>|&nbsp;</li>
  <li><a href="download.html">Download</a>|&nbsp;</li>
  <li><a href="api_reference.html">API Reference</a>|&nbsp;</li>
  <li><a href="about.html">About</a>|&nbsp;</li>
  <li><a href="search.html">Search</a>|&nbsp;</li>
  <li><a href="sitemap.html">Sitemap</a>&raquo;</li>

          <li><a href="api_reference.html" accesskey="U">API Reference</a> &raquo;</li> 
      </ul>
    </div>

  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <a href="http://amplab.cs.berkeley.edu">
    <img src="_static/amplab.png" width=100% border="0" alt="Amplab"/>
  </a>
  <a href="http://parlab.eecs.berkeley.edu">
    <img src="_static/parlab.png" width=100% border="0" alt="Amplab"/>
  </a>
  

  <h3><a href="sitemap.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Lithe C Runtime</a><ul>
<li><a class="reference internal" href="#api-calls">API Calls</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cpp_sched.html"
                        title="previous chapter">Lithe C++ Schedulers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cpp_runtime.html"
                        title="next chapter">Lithe C++ Runtime</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/c_runtime.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="lithe-c-runtime">
<h1>Lithe C Runtime<a class="headerlink" href="#lithe-c-runtime" title="Permalink to this headline">¶</a></h1>
<p>To access the Lithe C runtime API, include the following header file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#include &lt;lithe/lithe.h&gt;</span>
</pre></div>
</div>
<div class="section" id="api-calls">
<h2>API Calls<a class="headerlink" href="#api-calls" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>::</dt>
<dd>int lithe_sched_enter(lithe_sched_t <a href="#id1"><span class="problematic" id="id2">*</span></a>child);
int lithe_sched_exit();
lithe_sched_t <a href="#id3"><span class="problematic" id="id4">*</span></a>lithe_sched_current();
int lithe_hart_request(int k);
void lithe_hart_grant(lithe_sched_t <a href="#id5"><span class="problematic" id="id6">*</span></a>child, void (<a href="#id7"><span class="problematic" id="id8">*</span></a>unlock_func) (void <a href="#id9"><span class="problematic" id="id10">*</span></a>), void <a href="#id11"><span class="problematic" id="id12">*</span></a>lock);
void lithe_hart_yield();
void lithe_context_init(lithe_context_t <a href="#id13"><span class="problematic" id="id14">*</span></a>context, void (<a href="#id15"><span class="problematic" id="id16">*</span></a>func) (void <a href="#id17"><span class="problematic" id="id18">*</span></a>), void <a href="#id19"><span class="problematic" id="id20">*</span></a>arg);
void lithe_context_reinit(lithe_context_t <a href="#id21"><span class="problematic" id="id22">*</span></a>context, void (<a href="#id23"><span class="problematic" id="id24">*</span></a>func) (void <a href="#id25"><span class="problematic" id="id26">*</span></a>), void <a href="#id27"><span class="problematic" id="id28">*</span></a>arg);
void lithe_context_recycle(lithe_context_t <a href="#id29"><span class="problematic" id="id30">*</span></a>context, void (<a href="#id31"><span class="problematic" id="id32">*</span></a>func) (void <a href="#id33"><span class="problematic" id="id34">*</span></a>), void <a href="#id35"><span class="problematic" id="id36">*</span></a>arg);
void lithe_context_reassociate(lithe_context_t <a href="#id37"><span class="problematic" id="id38">*</span></a>context, lithe_sched_t <a href="#id39"><span class="problematic" id="id40">*</span></a>sched);
void lithe_context_cleanup(lithe_context_t <a href="#id41"><span class="problematic" id="id42">*</span></a>context);
lithe_context_t <a href="#id43"><span class="problematic" id="id44">*</span></a>lithe_context_self();
int lithe_context_run(lithe_context_t <a href="#id45"><span class="problematic" id="id46">*</span></a>context);
int lithe_context_block(void (<a href="#id47"><span class="problematic" id="id48">*</span></a>func) (lithe_context_t <a href="#id49"><span class="problematic" id="id50">*</span></a>, void <a href="#id51"><span class="problematic" id="id52">*</span></a>), void <a href="#id53"><span class="problematic" id="id54">*</span></a>arg);
int lithe_context_unblock(lithe_context_t <a href="#id55"><span class="problematic" id="id56">*</span></a>context);
void lithe_context_yield();
void lithe_context_exit();</dd>
</dl>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Passes control to a new child scheduler. The &#8216;funcs&#8217; field of the scheduler</li>
<li>must already be set up properly or the call will fail. It hands the current</li>
<li>hart over to this scheduler and then returns. To exit the child, a</li>
<li>subsequent call to lithe_sched_exit() is needed. Only at this point will</li>
<li>control be passed back to the parent scheduler. Returns -1 if there is an</li>
<li>error and sets errno appropriately.</li>
</ul>
<p class="last"><a href="#id57"><span class="problematic" id="id58">*</span></a>/</p>
</dd>
</dl>
<p>int lithe_sched_enter(lithe_sched_t <a href="#id59"><span class="problematic" id="id60">*</span></a>child);</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Exits the current scheduler, returning control to its parent. Must be paired</li>
<li>with a previous call to lithe_sched_enter(). Returns -1 if there is an error</li>
<li>and sets errno appropriately.</li>
</ul>
<p class="last"><a href="#id61"><span class="problematic" id="id62">*</span></a>/</p>
</dd>
</dl>
<p>int lithe_sched_exit();</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Return a pointer to the current scheduler. I.e. the pointer passed in</li>
<li>when the scheduler was entered.</li>
</ul>
<p class="last"><a href="#id63"><span class="problematic" id="id64">*</span></a>/</p>
</dd>
</dl>
<p>lithe_sched_t <a href="#id65"><span class="problematic" id="id66">*</span></a>lithe_sched_current();</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Request a specified number of harts from the parent. Note that the parent</li>
<li>is free to make a request using the calling hart to their own parent if</li>
<li>necessary. These harts will trickle in over time as they are granted to the</li>
<li>requesting scheduler. Returns 0 on success and -1 on error.</li>
</ul>
<p class="last"><a href="#id67"><span class="problematic" id="id68">*</span></a>/</p>
</dd>
</dl>
<p>int lithe_hart_request(int k);</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Grant the current hart to another scheduler.  Triggered by a previous call</li>
<li>to lithe_hart_request() by a child scheduler. This function never returns.</li>
<li>The &#8216;unlock_func()&#8217; and its corresponding &#8216;lock&#8217; parameter are passed in by</li>
<li>a parent scheduler so that the lithe runtime can synchronize references to</li>
<li>the child scheduler in the rare case that the child scheduler may currently</li>
<li>be in the process of exiting. For example, the unlock function passed in</li>
<li>should be the same one used to add/remove the child scheduler from a list in</li>
<li>the parent scheduler.</li>
</ul>
<p class="last"><a href="#id69"><span class="problematic" id="id70">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_hart_grant(lithe_sched_t <a href="#id71"><span class="problematic" id="id72">*</span></a>child, void (<a href="#id73"><span class="problematic" id="id74">*</span></a>unlock_func) (void <a href="#id75"><span class="problematic" id="id76">*</span></a>), void <a href="#id77"><span class="problematic" id="id78">*</span></a>lock);</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Yield current hart to parent scheduler. This function should</li>
<li>never return.</li>
</ul>
<p class="last"><a href="#id79"><span class="problematic" id="id80">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_hart_yield();</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Initialize the proper lithe internal state for an existing context. The</li>
<li>context parameter MUST already contain a valid stack pointer and stack size.</li>
<li>This function MUST be paired with a call to lithe_context_cleanup() in order</li>
<li>to properly cleanup the lithe internal state once the context is no longer</li>
<li>usable. This fucntion MUST only be called exactly ONCE for each newly</li>
<li>created lithe context. To reinitialize a context with a new start function</li>
<li>without calling lithe_context_cleanup() use lithe_context_reinit() or</li>
<li>lithe_context_recycle() as described below.  Once the context is restarted</li>
<li>it will run from the entry point specified.</li>
</ul>
<p class="last"><a href="#id81"><span class="problematic" id="id82">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_init(lithe_context_t <a href="#id83"><span class="problematic" id="id84">*</span></a>context, void (<a href="#id85"><span class="problematic" id="id86">*</span></a>func) (void <a href="#id87"><span class="problematic" id="id88">*</span></a>), void <a href="#id89"><span class="problematic" id="id90">*</span></a>arg);</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Used to reinitialize the lithe internal state for a context already</li>
<li>initialized via lithe_context_init().  Normally each call to</li>
<li>lithe_context_init() must be paired with a call to lithe_context_cleanup()</li>
<li>before the context can be reused for anything. The lithe_context_reinit()</li>
<li>function allows you to reinitialize this context with a new start function,</li>
<li>context id, and tls region (assuming tls support is enabled in the</li>
<li>underlying parlib library). It can be called any number of times before</li>
<li>pairing it with lithe_context_cleanup(). Once the context is restarted it</li>
<li>will run from the entry point specified.</li>
</ul>
<p class="last"><a href="#id91"><span class="problematic" id="id92">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_reinit(lithe_context_t <a href="#id93"><span class="problematic" id="id94">*</span></a>context, void (<a href="#id95"><span class="problematic" id="id96">*</span></a>func) (void <a href="#id97"><span class="problematic" id="id98">*</span></a>), void <a href="#id99"><span class="problematic" id="id100">*</span></a>arg);</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Similar to lithe_context_reinit() except that the context id and tls region</li>
<li>are preserved. Useful when tls and context id should be preserved across</li>
<li>lithe scheduler invocations.</li>
</ul>
<p class="last"><a href="#id101"><span class="problematic" id="id102">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_recycle(lithe_context_t <a href="#id103"><span class="problematic" id="id104">*</span></a>context, void (<a href="#id105"><span class="problematic" id="id106">*</span></a>func) (void <a href="#id107"><span class="problematic" id="id108">*</span></a>), void <a href="#id109"><span class="problematic" id="id110">*</span></a>arg);</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Reassociate a lithe context with a new scheduler.  Leaving the rest of it</li>
<li>alone. Useful when a context is parked on a barrier instead of exited and</li>
<li>then reused accross scheduler invocations.</li>
</ul>
<p class="last"><a href="#id111"><span class="problematic" id="id112">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_reassociate(lithe_context_t <a href="#id113"><span class="problematic" id="id114">*</span></a>context, lithe_sched_t <a href="#id115"><span class="problematic" id="id116">*</span></a>sched);</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Cleanup an existing context. This context should NOT currently be running on</li>
<li>any hart, though this is not enforced by the lithe runtime. Once called,</li>
<li>lithe_context_reinit() can no longer be called on this context.  It is now</li>
<li>safe to either call lithe_context_init() to reinitialize this context from</li>
<li>scratch, or simply free any memory associated with the context.</li>
</ul>
<p class="last"><a href="#id117"><span class="problematic" id="id118">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_cleanup(lithe_context_t <a href="#id119"><span class="problematic" id="id120">*</span></a>context);</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Returns a pointer to the currently executing context.</li>
</ul>
<p class="last"><a href="#id121"><span class="problematic" id="id122">*</span></a>/</p>
</dd>
</dl>
<p>lithe_context_t <a href="#id123"><span class="problematic" id="id124">*</span></a>lithe_context_self();</p>
<dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li>Run the specified context.  MUST only be run from hart context. Upon</li>
<li>completion, the context is yielded, and must be either retasked for other</li>
<li>use via lithe_context_reinit() or cleaned up via a call to</li>
<li>lithe_context_cleanup().  This function never returns on success and returns</li>
<li>-1 on error and sets errno appropriately.</li>
</ul>
<p class="last"><a href="#id125"><span class="problematic" id="id126">*</span></a>/</p>
</dd>
</dl>
<p>int lithe_context_run(lithe_context_t <a href="#id127"><span class="problematic" id="id128">*</span></a>context);</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first last simple">
<li>Invoke the specified function with the current context and block that</li>
<li>context. This function is useful for blocking a context and managing when to</li>
<li>unblock it by some component other than the scheduler associated with this</li>
<li>context.  The scheduler will recieve a callback notifying it that this</li>
<li>context has blocked and should not be run. The scheduler will receive</li>
<li>another callback later to notify it when this context has unblocked and can</li>
<li>once again be resumed. Returns 0 on success (after the context has been</li>
<li>resumed) and -1 on error and sets errno appropriately.</li>
</ul>
</dd>
</dl>
<p><a href="#id129"><span class="problematic" id="id130">*</span></a>/
int lithe_context_block(void (<a href="#id131"><span class="problematic" id="id132">*</span></a>func) (lithe_context_t <a href="#id133"><span class="problematic" id="id134">*</span></a>, void <a href="#id135"><span class="problematic" id="id136">*</span></a>), void <a href="#id137"><span class="problematic" id="id138">*</span></a>arg);</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Notifies the current scheduler that the specified context is now resumable.</li>
<li>This chould only be called on contexts previously blocked via a call to</li>
<li>lithe_context_block(). Returns 0 on success and -1 on error and sets errno</li>
<li>appropriately.</li>
</ul>
<p class="last"><a href="#id139"><span class="problematic" id="id140">*</span></a>/</p>
</dd>
</dl>
<p>int lithe_context_unblock(lithe_context_t <a href="#id141"><span class="problematic" id="id142">*</span></a>context);</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Cooperatively yield the current context to the current scheduler.  The</li>
<li>scheduler receives a callback notifiying it that the context has yielded and</li>
<li>can decide from there when to resume it.</li>
</ul>
<p class="last"><a href="#id143"><span class="problematic" id="id144">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_yield();</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Stop execution of the current context immediately. The scheduler receives a</li>
<li>callback notifiying it that the context has exited and can decide from there</li>
<li>what to do.</li>
</ul>
<p class="last"><a href="#id145"><span class="problematic" id="id146">*</span></a>/</p>
</dd>
</dl>
<p>void lithe_context_exit();</p>
<p>#ifdef __cplusplus
}
#endif</p>
<p>#endif  // LITHE_H</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="cpp_runtime.html" title="Lithe C++ Runtime"
             >next</a> |</li>
        <li class="right" >
          <a href="cpp_sched.html" title="Lithe C++ Schedulers"
             >previous</a> |</li>
  <li><a href="index.html">Home</a>|&nbsp;</li>
  <li><a href="download.html">Download</a>|&nbsp;</li>
  <li><a href="api_reference.html">API Reference</a>|&nbsp;</li>
  <li><a href="about.html">About</a>|&nbsp;</li>
  <li><a href="search.html">Search</a>|&nbsp;</li>
  <li><a href="sitemap.html">Sitemap</a>&raquo;</li>

          <li><a href="api_reference.html" >API Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, The Regents of the University of California.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>