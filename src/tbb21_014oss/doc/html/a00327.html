<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>parallel_reduce.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>parallel_reduce.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">    Copyright 2005-2008 Intel Corporation.  All Rights Reserved.</span>
00003 <span class="comment"></span>
00004 <span class="comment">    The source code contained or described herein and all documents related</span>
00005 <span class="comment">    to the source code ("Material") are owned by Intel Corporation or its</span>
00006 <span class="comment">    suppliers or licensors.  Title to the Material remains with Intel</span>
00007 <span class="comment">    Corporation or its suppliers and licensors.  The Material is protected</span>
00008 <span class="comment">    by worldwide copyright laws and treaty provisions.  No part of the</span>
00009 <span class="comment">    Material may be used, copied, reproduced, modified, published, uploaded,</span>
00010 <span class="comment">    posted, transmitted, distributed, or disclosed in any way without</span>
00011 <span class="comment">    Intel's prior express written permission.</span>
00012 <span class="comment"></span>
00013 <span class="comment">    No license under any patent, copyright, trade secret or other</span>
00014 <span class="comment">    intellectual property right is granted to or conferred upon you by</span>
00015 <span class="comment">    disclosure or delivery of the Materials, either expressly, by</span>
00016 <span class="comment">    implication, inducement, estoppel or otherwise.  Any license under such</span>
00017 <span class="comment">    intellectual property rights must be express and approved by Intel in</span>
00018 <span class="comment">    writing.</span>
00019 <span class="comment">*/</span>
00020 
00021 <span class="preprocessor">#ifndef __TBB_parallel_reduce_H</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define __TBB_parallel_reduce_H</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#include "task.h"</span>
00025 <span class="preprocessor">#include "aligned_space.h"</span>
00026 <span class="preprocessor">#include "partitioner.h"</span>
00027 <span class="preprocessor">#include &lt;new&gt;</span>
00028 
00029 <span class="keyword">namespace </span>tbb {
00030 
00032 <span class="keyword">namespace </span>internal {
00033 
00035     <span class="keywordtype">void</span> __TBB_EXPORTED_FUNC <a class="code" href="a00311.html#a55">itt_store_pointer_with_release_v3</a>( <span class="keywordtype">void</span>* dst, <span class="keywordtype">void</span>* src );
00036 
00038     <span class="keywordtype">void</span>* __TBB_EXPORTED_FUNC <a class="code" href="a00311.html#a56">itt_load_pointer_with_acquire_v3</a>( <span class="keyword">const</span> <span class="keywordtype">void</span>* src );
00039 
00040     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> parallel_reduce_store_body( T*&amp; dst, T* src ) {
00041 <span class="preprocessor">#if TBB_USE_THREADING_TOOLS</span>
00042 <span class="preprocessor"></span>        <a class="code" href="a00311.html#a55">itt_store_pointer_with_release_v3</a>(&amp;dst,src);
00043 <span class="preprocessor">#else</span>
00044 <span class="preprocessor"></span>        __TBB_store_with_release(dst,src);
00045 <span class="preprocessor">#endif </span><span class="comment">/* TBB_USE_THREADING_TOOLS */</span>
00046     }
00047 
00048     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T* parallel_reduce_load_body( T*&amp; src ) {
00049 <span class="preprocessor">#if TBB_USE_THREADING_TOOLS</span>
00050 <span class="preprocessor"></span>        <span class="keywordflow">return</span> static_cast&lt;T*&gt;(<a class="code" href="a00311.html#a56">itt_load_pointer_with_acquire_v3</a>(&amp;src));
00051 <span class="preprocessor">#else</span>
00052 <span class="preprocessor"></span>        <span class="keywordflow">return</span> __TBB_load_with_acquire(src);
00053 <span class="preprocessor">#endif </span><span class="comment">/* TBB_USE_THREADING_TOOLS */</span>
00054     }
00055 
00057 
00058     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Body&gt;
<a name="l00059"></a><a class="code" href="a00214.html">00059</a>     <span class="keyword">class </span><a class="code" href="a00214.html">finish_reduce</a>: <span class="keyword">public</span> <a class="code" href="a00255.html">task</a> {
00060         Body* <span class="keyword">const</span> my_body;
00061         <span class="keywordtype">bool</span> has_right_zombie;
00062         <a class="code" href="a00185.html">aligned_space&lt;Body,1&gt;</a> zombie_space;
00063         <a class="code" href="a00214.html">finish_reduce</a>( Body* body ) : 
00064             my_body(body),
00065             has_right_zombie(<span class="keyword">false</span>)
00066         {
00067         }
00068         <a class="code" href="a00255.html">task</a>* execute() {
00069             <span class="keywordflow">if</span>( has_right_zombie ) {
00070                 <span class="comment">// Right child was stolen.</span>
00071                 Body* s = zombie_space.begin();
00072                 my_body-&gt;join( *s );
00073                 s-&gt;~Body();
00074             }
00075             <span class="keywordflow">return</span> NULL;
00076         }       
00077         <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range,<span class="keyword">typename</span> Body_, <span class="keyword">typename</span> Partitioner&gt;
00078         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00250.html">start_reduce</a>;
00079     };
00080 
00082 
00083     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body, <span class="keyword">typename</span> Partitioner&gt;
<a name="l00084"></a><a class="code" href="a00250.html">00084</a>     <span class="keyword">class </span><a class="code" href="a00250.html">start_reduce</a>: <span class="keyword">public</span> <a class="code" href="a00255.html">task</a> {
00085         <span class="keyword">typedef</span> <a class="code" href="a00214.html">finish_reduce&lt;Body&gt;</a> <a class="code" href="a00214.html">finish_type</a>;
00086         Body* my_body;
00087         Range my_range;
00088         <span class="keyword">typename</span> Partitioner::partition_type my_partition;
00089         <span class="comment">/*override*/</span> <a class="code" href="a00255.html">task</a>* execute();
00090         <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Body_&gt;
00091         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00214.html">finish_reduce</a>;
00092     
00094         <a class="code" href="a00250.html">start_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body* body, <span class="keyword">const</span> Partitioner &amp;partitioner ) :
00095             my_body(body),
00096             my_range(range),
00097             my_partition(partitioner)
00098         {
00099         }
00101 
00102         <a class="code" href="a00250.html">start_reduce</a>( <a class="code" href="a00250.html">start_reduce</a>&amp; parent, <a class="code" href="a00248.html">split</a> ) :
00103             my_body(parent.<a class="code" href="a00250.html#r0">my_body</a>),
00104             my_range(parent.<a class="code" href="a00250.html#r1">my_range</a>,<a class="code" href="a00248.html">split</a>()),
00105             my_partition(parent.<a class="code" href="a00250.html#r2">my_partition</a>,<a class="code" href="a00248.html">split</a>())
00106         {
00107         }
00109 
00110         <span class="comment">/*override*/</span> <span class="keywordtype">void</span> note_affinity( <a class="code" href="a00311.html#a11">affinity_id</a> <span class="comment">/*id*/</span> ) {
00111             <a class="code" href="a00214.html">finish_type</a>* p = static_cast&lt;finish_type*&gt;(parent() );
00112             Body* body = <span class="keyword">new</span>( p-&gt;<a class="code" href="a00214.html#r2">zombie_space</a>.<a class="code" href="a00185.html#a0">begin</a>() ) Body(*my_body,<a class="code" href="a00248.html">split</a>());
00113             p-&gt;<a class="code" href="a00214.html#r1">has_right_zombie</a> = <span class="keyword">true</span>;
00114             my_body = body;
00115         }
00116     <span class="keyword">public</span>:
00117 <span class="preprocessor">#if !__TBB_EXCEPTIONS</span>
00118 <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> run( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> Partitioner &amp;partitioner ) {
00119             <span class="keywordflow">if</span>( !range.empty() ) 
00120                 task::spawn_root_and_wait( *<span class="keyword">new</span>(task::allocate_root()) <a class="code" href="a00250.html">start_reduce</a>(range,&amp;body,partitioner) );
00121         }
00122 <span class="preprocessor">#else </span><span class="comment">/* __TBB_EXCEPTIONS */</span>
00123         <span class="keyword">static</span> <span class="keywordtype">void</span> run( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> Partitioner &amp;partitioner ) {
00124             <span class="comment">// Bound context prevents exceptions from body to affect nesting or sibling algorithms,</span>
00125             <span class="comment">// and allows users to handle exceptions safely by wrapping parallel_for in the try-block.</span>
00126             <span class="keywordflow">if</span>( !range.empty() )  {
00127                 <a class="code" href="a00256.html">task_group_context</a> context;
00128                 task::spawn_root_and_wait( *<span class="keyword">new</span>(task::allocate_root(context)) <a class="code" href="a00250.html">start_reduce</a>(range,&amp;body,partitioner) );
00129             }
00130         }
00131         <span class="keyword">static</span> <span class="keywordtype">void</span> run( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> Partitioner &amp;partitioner, <a class="code" href="a00256.html">task_group_context</a>&amp; context ) {
00132             <span class="keywordflow">if</span>( !range.empty() ) 
00133                 task::spawn_root_and_wait( *<span class="keyword">new</span>(task::allocate_root(context)) <a class="code" href="a00250.html">start_reduce</a>(range,&amp;body,partitioner) );
00134         }
00135 <span class="preprocessor">#endif </span><span class="comment">/* __TBB_EXCEPTIONS */</span>
00136     };
00137 
00138     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body, <span class="keyword">typename</span> Partitioner&gt;
00139     <a class="code" href="a00255.html">task</a>* <a class="code" href="a00250.html">start_reduce&lt;Range,Body,Partitioner&gt;::execute</a>() {
00140         <span class="keywordflow">if</span>( !my_range.is_divisible() || my_partition.should_execute_range(*<span class="keyword">this</span>) ) {
00141             (*my_body)( my_range );
00142             <span class="keywordflow">return</span> NULL;
00143         } <span class="keywordflow">else</span> {
00144             finish_type&amp; c = *<span class="keyword">new</span>( <a class="code" href="a00255.html#a2">allocate_continuation</a>()) finish_type(my_body);
00145             <a class="code" href="a00255.html#a8">recycle_as_child_of</a>(c);
00146             c.<a class="code" href="a00255.html#a13">set_ref_count</a>(2);    
00147             start_reduce&amp; b = *<span class="keyword">new</span>( c.allocate_child() ) start_reduce(*<span class="keyword">this</span>,<a class="code" href="a00248.html">split</a>());
00148             <a class="code" href="a00255.html#a14">spawn</a>(b);
00149             <span class="keywordflow">return</span> <span class="keyword">this</span>;
00150         }
00151     }
00152  
00154 
<a name="l00155"></a><a class="code" href="a00311.html#a7">00155</a>     <span class="keyword">typedef</span> <span class="keywordtype">char</span> reduction_context;
00156 
00158 
00159     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Body&gt;
<a name="l00160"></a><a class="code" href="a00215.html">00160</a>     <span class="keyword">class </span><a class="code" href="a00215.html">finish_reduce_with_affinity</a>: <span class="keyword">public</span> <a class="code" href="a00255.html">task</a> {
00162         Body* my_body;
00163         <span class="keywordtype">bool</span> has_right_zombie;
00164         <span class="keyword">const</span> <a class="code" href="a00311.html#a7">reduction_context</a> my_context;
00165         <a class="code" href="a00185.html">aligned_space&lt;Body,1&gt;</a> zombie_space;
00166         <a class="code" href="a00215.html">finish_reduce_with_affinity</a>( <span class="keywordtype">char</span> context ) : 
00167             my_body(NULL),
00168             has_right_zombie(<span class="keyword">false</span>),
00169             my_context(context)
00170         {
00171         }
00172         <a class="code" href="a00255.html">task</a>* <a class="code" href="a00255.html#a1">execute</a>() {
00173             <span class="keywordflow">if</span>( has_right_zombie ) {
00174                 <span class="comment">// Right child was stolen.</span>
00175                 Body* s = zombie_space.<a class="code" href="a00185.html#a0">begin</a>();
00176                 my_body-&gt;join( *s );
00177                 s-&gt;~Body();
00178             }
00179             <span class="keywordflow">if</span>( my_context==1 ) 
00180                 parallel_reduce_store_body( static_cast&lt;finish_reduce_with_affinity*&gt;(<a class="code" href="a00255.html#a19">parent</a>())-&gt;my_body, my_body );
00181             <span class="keywordflow">return</span> NULL;
00182         }       
00183         <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range,<span class="keyword">typename</span> Body_&gt;
00184         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00251.html">start_reduce_with_affinity</a>;
00185     };
00186 
00188 
00189     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00190"></a><a class="code" href="a00251.html">00190</a>     <span class="keyword">class </span><a class="code" href="a00251.html">start_reduce_with_affinity</a>: <span class="keyword">public</span> <a class="code" href="a00255.html">task</a> {
00191         <span class="keyword">typedef</span> <a class="code" href="a00215.html">finish_reduce_with_affinity&lt;Body&gt;</a> <a class="code" href="a00215.html">finish_type</a>;
00192         Body* my_body;
00193         Range my_range;
00194         <span class="keyword">typename</span> affinity_partitioner::partition_type my_partition;
00195         <a class="code" href="a00311.html#a7">reduction_context</a> my_context;
00196         <span class="comment">/*override*/</span> <a class="code" href="a00255.html">task</a>* <a class="code" href="a00255.html#a1">execute</a>();
00197         <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Body_&gt;
00198         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00215.html">finish_reduce_with_affinity</a>;
00199     
00201         <a class="code" href="a00251.html">start_reduce_with_affinity</a>( <span class="keyword">const</span> Range&amp; range, Body* body, <a class="code" href="a00183.html">affinity_partitioner</a>&amp; partitioner ) :
00202             my_body(body),
00203             my_range(range),
00204             my_partition(partitioner),
00205             my_context(0)
00206         {
00207         }
00209 
00210         <a class="code" href="a00251.html">start_reduce_with_affinity</a>( <a class="code" href="a00251.html">start_reduce_with_affinity</a>&amp; parent, <a class="code" href="a00248.html">split</a> ) :
00211             my_body(parent.<a class="code" href="a00251.html#r0">my_body</a>),
00212             my_range(parent.<a class="code" href="a00251.html#r1">my_range</a>,<a class="code" href="a00248.html">split</a>()),
00213             my_partition(parent.<a class="code" href="a00251.html#r2">my_partition</a>,<a class="code" href="a00248.html">split</a>()),
00214             my_context(2)
00215         {
00216             my_partition.<a class="code" href="a00255.html#a24">set_affinity</a>(*<span class="keyword">this</span>);
00217             parent.<a class="code" href="a00251.html#r3">my_context</a> = 1;
00218         }
00220         <span class="comment">/*override*/</span> <span class="keywordtype">void</span> <a class="code" href="a00255.html#a26">note_affinity</a>( affinity_id <span class="keywordtype">id</span> ) {
00221             my_partition.<a class="code" href="a00251.html#d3">note_affinity</a>( <span class="keywordtype">id</span> );
00222         }
00223 
00224 <span class="keyword">public</span>:
00225         <span class="keyword">static</span> <span class="keywordtype">void</span> run( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <a class="code" href="a00183.html">affinity_partitioner</a>&amp; partitioner ) {
00226             <span class="keywordflow">if</span>( !range.empty() ) {
00227 <span class="preprocessor">#if !__TBB_EXCEPTIONS || TBB_JOIN_OUTER_TASK_GROUP</span>
00228 <span class="preprocessor"></span>                task::spawn_root_and_wait( *<span class="keyword">new</span>(task::allocate_root()) <a class="code" href="a00251.html">start_reduce_with_affinity</a>(range,&amp;body,partitioner) );
00229 <span class="preprocessor">#else</span>
00230 <span class="preprocessor"></span>                <span class="comment">// Bound context prevents exceptions from body to affect nesting or sibling algorithms,</span>
00231                 <span class="comment">// and allows users to handle exceptions safely by wrapping parallel_for in the try-block.</span>
00232                 <a class="code" href="a00256.html">task_group_context</a> context;
00233                 task::spawn_root_and_wait( *<span class="keyword">new</span>(task::allocate_root(context)) <a class="code" href="a00251.html">start_reduce_with_affinity</a>(range,&amp;body,partitioner) );
00234 <span class="preprocessor">#endif </span><span class="comment">/* __TBB_EXCEPTIONS &amp;&amp; !TBB_JOIN_OUTER_TASK_GROUP */</span>
00235             }
00236         }
00237 <span class="preprocessor">#if __TBB_EXCEPTIONS</span>
00238 <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> run( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <a class="code" href="a00183.html">affinity_partitioner</a>&amp; partitioner, <a class="code" href="a00256.html">task_group_context</a>&amp; context ) {
00239             <span class="keywordflow">if</span>( !range.empty() ) 
00240                 task::spawn_root_and_wait( *<span class="keyword">new</span>(task::allocate_root(context)) <a class="code" href="a00251.html">start_reduce_with_affinity</a>(range,&amp;body,partitioner) );
00241         }
00242 <span class="preprocessor">#endif </span><span class="comment">/* __TBB_EXCEPTIONS */</span>
00243     };
00244 
00245     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
00246     <a class="code" href="a00255.html">task</a>* <a class="code" href="a00251.html">start_reduce_with_affinity&lt;Range,Body&gt;::execute</a>() {
00247         <span class="keywordflow">if</span>( my_context==2 ) {
00248             finish_type* p = static_cast&lt;finish_type*&gt;(<a class="code" href="a00255.html#a19">parent</a>() );
00249             <span class="keywordflow">if</span>( !parallel_reduce_load_body(p-&gt;my_body) ) {
00250                 my_body = <span class="keyword">new</span>( p-&gt;zombie_space.begin() ) Body(*my_body,<a class="code" href="a00248.html">split</a>());
00251                 p-&gt;has_right_zombie = <span class="keyword">true</span>;
00252             } 
00253         }
00254         <span class="keywordflow">if</span>( !my_range.is_divisible() || my_partition.should_execute_range(*<span class="keyword">this</span>) ) {
00255             (*my_body)( my_range );
00256             <span class="keywordflow">if</span>( my_context==1 ) 
00257                 parallel_reduce_store_body(static_cast&lt;finish_type*&gt;(<a class="code" href="a00255.html#a19">parent</a>())-&gt;my_body, my_body );
00258             <span class="keywordflow">return</span> my_partition.continue_after_execute_range(*<span class="keyword">this</span>);
00259         } <span class="keywordflow">else</span> {
00260             finish_type&amp; c = *<span class="keyword">new</span>( <a class="code" href="a00255.html#a2">allocate_continuation</a>()) finish_type(my_context);
00261             <a class="code" href="a00255.html#a8">recycle_as_child_of</a>(c);
00262             c.<a class="code" href="a00255.html#a13">set_ref_count</a>(2);    
00263             <span class="keywordtype">bool</span> delay = my_partition.decide_whether_to_delay();
00264             start_reduce_with_affinity&amp; b = *<span class="keyword">new</span>( c.allocate_child() ) start_reduce_with_affinity(*<span class="keyword">this</span>,split());
00265             my_partition.spawn_or_delay(delay,*<span class="keyword">this</span>,b);
00266             <span class="keywordflow">return</span> <span class="keyword">this</span>;
00267         }
00268     } 
00269 
00271 
00275     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00276"></a><a class="code" href="a00220.html">00276</a>     <span class="keyword">class </span><a class="code" href="a00220.html">lambda_reduce_body</a> {
00277 
00278 <span class="comment">//FIXME: decide if my_real_body, my_reduction, and identity_element should be copied or referenced</span>
00279 <span class="comment">//       (might require some performance measurements)</span>
00280 
00281         <span class="keyword">const</span> Value&amp;     identity_element;
00282         <span class="keyword">const</span> RealBody&amp;  my_real_body;
00283         <span class="keyword">const</span> Reduction&amp; my_reduction;
00284         Value            my_value;
00285     <span class="keyword">public</span>:
00286         <a class="code" href="a00220.html">lambda_reduce_body</a>( <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; body, <span class="keyword">const</span> Reduction&amp; reduction )
00287             : identity_element(identity)
00288             , my_real_body(body)
00289             , my_reduction(reduction)
00290             , my_value(identity)
00291         { }
00292         <a class="code" href="a00220.html">lambda_reduce_body</a>( <span class="keyword">const</span> <a class="code" href="a00220.html">lambda_reduce_body</a>&amp; other )
00293             : identity_element(other.<a class="code" href="a00220.html#r0">identity_element</a>)
00294             , my_real_body(other.<a class="code" href="a00220.html#r1">my_real_body</a>)
00295             , my_reduction(other.<a class="code" href="a00220.html#r2">my_reduction</a>)
00296             , my_value(other.<a class="code" href="a00220.html#r3">my_value</a>)
00297         { }
00298         <a class="code" href="a00220.html">lambda_reduce_body</a>( <a class="code" href="a00220.html">lambda_reduce_body</a>&amp; other, <a class="code" href="a00248.html">tbb::split</a> )
00299             : identity_element(other.<a class="code" href="a00220.html#r0">identity_element</a>)
00300             , my_real_body(other.<a class="code" href="a00220.html#r1">my_real_body</a>)
00301             , my_reduction(other.<a class="code" href="a00220.html#r2">my_reduction</a>)
00302             , my_value(other.<a class="code" href="a00220.html#r0">identity_element</a>)
00303         { }
00304         <span class="keywordtype">void</span> operator()(Range&amp; range) {
00305             my_value = my_real_body(range, const_cast&lt;const Value&amp;&gt;(my_value));
00306         }
00307         <span class="keywordtype">void</span> join( <a class="code" href="a00220.html">lambda_reduce_body</a>&amp; rhs ) {
00308             my_value = my_reduction(const_cast&lt;const Value&amp;&gt;(my_value), const_cast&lt;const Value&amp;&gt;(rhs.<a class="code" href="a00220.html#r3">my_value</a>));
00309         }
00310         Value result()<span class="keyword"> const </span>{
00311             <span class="keywordflow">return</span> my_value;
00312         }
00313     };
00314 
00315 } <span class="comment">// namespace internal</span>
00317 <span class="comment"></span>
00318 <span class="comment">// Requirements on Range concept are documented in blocked_range.h</span>
00319 
00338 
00340 
00341 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00342"></a><a class="code" href="a00313.html#ga11">00342</a> <span class="keywordtype">void</span> <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> simple_partitioner&amp; partitioner = simple_partitioner() ) {
00343     internal::start_reduce&lt;Range,Body,simple_partitioner&gt;::run( range, body, partitioner );
00344 }
00345 
00347 
00348 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00349"></a><a class="code" href="a00313.html#ga12">00349</a> <span class="keywordtype">void</span> <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> auto_partitioner&amp; partitioner ) {
00350     internal::start_reduce&lt;Range,Body,auto_partitioner&gt;::run( range, body, partitioner );
00351 }
00352 
00354 
00355 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00356"></a><a class="code" href="a00313.html#ga13">00356</a> <span class="keywordtype">void</span> <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body&amp; body, affinity_partitioner&amp; partitioner ) {
00357     internal::start_reduce_with_affinity&lt;Range,Body&gt;::run( range, body, partitioner );
00358 }
00359 
00360 <span class="preprocessor">#if __TBB_EXCEPTIONS</span>
00361 <span class="preprocessor"></span>
00362 
00363 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00364"></a><a class="code" href="a00313.html#ga14">00364</a> <span class="keywordtype">void</span> <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> simple_partitioner&amp; partitioner, task_group_context&amp; context ) {
00365     internal::start_reduce&lt;Range,Body,simple_partitioner&gt;::run( range, body, partitioner, context );
00366 }
00367 
00369 
00370 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00371"></a><a class="code" href="a00313.html#ga15">00371</a> <span class="keywordtype">void</span> <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body&amp; body, <span class="keyword">const</span> auto_partitioner&amp; partitioner, task_group_context&amp; context ) {
00372     internal::start_reduce&lt;Range,Body,auto_partitioner&gt;::run( range, body, partitioner, context );
00373 }
00374 
00376 
00377 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Body&gt;
<a name="l00378"></a><a class="code" href="a00313.html#ga16">00378</a> <span class="keywordtype">void</span> <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, Body&amp; body, affinity_partitioner&amp; partitioner, task_group_context&amp; context ) {
00379     internal::start_reduce_with_affinity&lt;Range,Body&gt;::run( range, body, partitioner, context );
00380 }
00381 <span class="preprocessor">#endif </span><span class="comment">/* __TBB_EXCEPTIONS */</span>
00382 
00386 
00387 
00388 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00389"></a><a class="code" href="a00313.html#ga17">00389</a> Value <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; real_body, <span class="keyword">const</span> Reduction&amp; reduction,
00390                        <span class="keyword">const</span> simple_partitioner&amp; partitioner = simple_partitioner() ) {
00391     internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; body(identity, real_body, reduction);
00392     internal::start_reduce&lt;Range,internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt;,simple_partitioner&gt;
00393                           ::run(range, body, partitioner );
00394     <span class="keywordflow">return</span> body.result();
00395 }
00396 
00398 
00399 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00400"></a><a class="code" href="a00313.html#ga18">00400</a> Value <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; real_body, <span class="keyword">const</span> Reduction&amp; reduction,
00401                        <span class="keyword">const</span> auto_partitioner&amp; partitioner ) {
00402     internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; body(identity, real_body, reduction);
00403     internal::start_reduce&lt;Range,internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt;,auto_partitioner&gt;
00404                           ::run( range, body, partitioner );
00405     <span class="keywordflow">return</span> body.result();
00406 }
00407 
00409 
00410 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00411"></a><a class="code" href="a00313.html#ga19">00411</a> Value <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; real_body, <span class="keyword">const</span> Reduction&amp; reduction,
00412                        affinity_partitioner&amp; partitioner ) {
00413     internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; body(identity, real_body, reduction);
00414     internal::start_reduce_with_affinity&lt;Range,internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; &gt;
00415                                         ::run( range, body, partitioner );
00416     <span class="keywordflow">return</span> body.result();
00417 }
00418 
00419 <span class="preprocessor">#if __TBB_EXCEPTIONS</span>
00420 <span class="preprocessor"></span>
00421 
00422 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00423"></a><a class="code" href="a00313.html#ga20">00423</a> Value <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; real_body, <span class="keyword">const</span> Reduction&amp; reduction,
00424                        <span class="keyword">const</span> simple_partitioner&amp; partitioner, task_group_context&amp; context ) {
00425     internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; body(identity, real_body, reduction);
00426     internal::start_reduce&lt;Range,internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt;,simple_partitioner&gt;
00427                           ::run( range, body, partitioner, context );
00428     <span class="keywordflow">return</span> body.result();
00429 }
00430 
00432 
00433 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00434"></a><a class="code" href="a00313.html#ga21">00434</a> Value <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; real_body, <span class="keyword">const</span> Reduction&amp; reduction,
00435                        <span class="keyword">const</span> auto_partitioner&amp; partitioner, task_group_context&amp; context ) {
00436     internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; body(identity, real_body, reduction);
00437     internal::start_reduce&lt;Range,internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt;,auto_partitioner&gt;
00438                           ::run( range, body, partitioner, context );
00439     <span class="keywordflow">return</span> body.result();
00440 }
00441 
00443 
00444 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Range, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> RealBody, <span class="keyword">typename</span> Reduction&gt;
<a name="l00445"></a><a class="code" href="a00313.html#ga22">00445</a> Value <a class="code" href="a00313.html#ga11">parallel_reduce</a>( <span class="keyword">const</span> Range&amp; range, <span class="keyword">const</span> Value&amp; identity, <span class="keyword">const</span> RealBody&amp; real_body, <span class="keyword">const</span> Reduction&amp; reduction,
00446                        affinity_partitioner&amp; partitioner, task_group_context&amp; context ) {
00447     internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; body(identity, real_body, reduction);
00448     internal::start_reduce_with_affinity&lt;Range,internal::lambda_reduce_body&lt;Range,Value,RealBody,Reduction&gt; &gt;
00449                                         ::run( range, body, partitioner, context );
00450     <span class="keywordflow">return</span> body.result();
00451 }
00452 <span class="preprocessor">#endif </span><span class="comment">/* __TBB_EXCEPTIONS */</span>
00453 
00454 
00455 } <span class="comment">// namespace tbb</span>
00456 
00457 <span class="preprocessor">#endif </span><span class="comment">/* __TBB_parallel_reduce_H */</span>
00458 
</pre></div><hr>
<p></p>
Copyright &copy; 2005-2008 Intel Corporation.  All Rights Reserved.
<p></p>
Intel, Pentium, Intel Xeon, Itanium, Intel XScale and VTune are
registered trademarks or trademarks of Intel Corporation or its
subsidiaries in the United States and other countries.
<p></p>
* Other names and brands may be claimed as the property of others.
